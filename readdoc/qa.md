# 函数原型(proto)有什么? 为什么可以共享? 怎么共享的?

1 回答第一个问题前先理解下类和对象的关系，在编程中我们用不同的数据和类可以构造不同的对象，这些创建出来的对象虽然是独立的但是从实际上来说是共享这个类定义的代码的，只是在执行不同的成员函数时给成员函数传递的是不同的对象而已。同理lua函数实现也是类似的方式，它主要分为函数原型（Proto）、函数对象（LClosure）、UpValue 三个部分，其中函数原型是共享的，而函数对象和UpValue是不同的，函数对象是每次调用函数时创建的，而UpValue是在函数对象创建时创建的，因此可以将UpValue理解为是函数对象的数据，正是因为数据不同所以造成了函数对象的不同。
2 根据第一个问题答案可以知道函数原型是可以共享的，那函数原型在不同虚拟机中共享时如何保证函数正常执行呢？ 因为函数原型里记录了每个 UpValue 的位置信息描述，在不同虚拟机中加载文件共享函数原型时，文件中的被函数原型索引位置的UpValue对象是不共享的，每次加载文件会有单独的一份，因此可以根据函数型中的UpValue位置信息索引到不同文件对象中的UpValue，这就是函数原型在不同虚拟机中共享的原理。
